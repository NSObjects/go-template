# golangci-lint é…ç½®æ€»ç»“

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. é…ç½® golangci-lint
- ä½¿ç”¨ golangci-lint v2.4.0
- ç”±äºé…ç½®æ–‡ä»¶æ ¼å¼å…¼å®¹æ€§é—®é¢˜ï¼Œé‡‡ç”¨å‘½ä»¤è¡Œå‚æ•°é…ç½®
- è·³è¿‡ vendor ç›®å½•å’Œç”Ÿæˆçš„ä»£ç æ–‡ä»¶

### 2. é›†æˆåˆ° Makefile
æ·»åŠ äº†å®Œæ•´çš„ lint å‘½ä»¤é›†ï¼š

```bash
# åŸºç¡€æ£€æŸ¥
make lint                 # è¿è¡Œæ‰€æœ‰ linterï¼ˆå…è®¸å¤±è´¥ï¼‰
make lint-strict          # ä¸¥æ ¼æ£€æŸ¥ï¼ˆå¤±è´¥æ—¶é€€å‡ºï¼‰
make lint-fast            # å¿«é€Ÿæ£€æŸ¥ï¼ˆåªè¿è¡Œå¿«é€Ÿ linterï¼‰

# ä¿®å¤å’ŒæŠ¥å‘Š
make lint-fix             # è‡ªåŠ¨ä¿®å¤å¯ä¿®å¤çš„é—®é¢˜
make lint-report          # ç”Ÿæˆ checkstyle æ ¼å¼æŠ¥å‘Š

# ç‰¹å®šç›®å½•æ£€æŸ¥
make lint-dir DIR=./path  # æ£€æŸ¥ç‰¹å®šç›®å½•

# å®‰è£…å·¥å…·
make install-lint         # å®‰è£… golangci-lint
```

### 3. è‡ªåŠ¨ä¿®å¤æ•ˆæœ
- è¿è¡Œ `make lint-fix` åï¼Œé—®é¢˜ä» 30 ä¸ªå‡å°‘åˆ° 25 ä¸ª
- è‡ªåŠ¨ä¿®å¤äº† 5 ä¸ªå¯ä»¥è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜
- ä¸»è¦æ˜¯æ ¼å¼åŒ–å’Œç®€å•çš„ä»£ç ä¼˜åŒ–é—®é¢˜

## ğŸ“Š å½“å‰é—®é¢˜ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | æè¿° |
|------|------|------|
| errcheck | 6 | æœªæ£€æŸ¥çš„é”™è¯¯è¿”å›å€¼ |
| govet | 3 | æ ¼å¼å­—ç¬¦ä¸²é—®é¢˜ |
| staticcheck | 15 | ä»£ç è´¨é‡é—®é¢˜ |
| unused | 1 | æœªä½¿ç”¨çš„å­—æ®µ |
| **æ€»è®¡** | **25** | **éœ€è¦æ‰‹åŠ¨ä¿®å¤** |

## ğŸ”§ éœ€è¦æ‰‹åŠ¨ä¿®å¤çš„é—®é¢˜

### 1. errcheck (6ä¸ª) - é«˜ä¼˜å…ˆçº§
æœªæ£€æŸ¥çš„é”™è¯¯è¿”å›å€¼ï¼Œå¯èƒ½å¯¼è‡´é”™è¯¯è¢«å¿½ç•¥ï¼š

```go
// éœ€è¦ä¿®å¤çš„æ–‡ä»¶ï¼š
- internal/log/elasticsearch_sink.go:77
- internal/log/logger.go:55
- internal/log/logger_test.go:111,145
- internal/log/loki_sink.go:89
- muban/modgen/utils/file_utils.go:37
```

### 2. govet (3ä¸ª) - ä¸­ä¼˜å…ˆçº§
æ ¼å¼å­—ç¬¦ä¸²é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ï¼š

```go
// éœ€è¦ä¿®å¤çš„æ–‡ä»¶ï¼š
- muban/modgen/templates/openapi_templates.go:261
- muban/modgen/templates/test_templates.go:183,550
```

### 3. staticcheck (15ä¸ª) - ä¸­ä¼˜å…ˆçº§
ä»£ç è´¨é‡é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š
- åºŸå¼ƒçš„ API ä½¿ç”¨
- ç©ºçš„ä»£ç åˆ†æ”¯
- ä¸å®‰å…¨çš„ context key ä½¿ç”¨
- ä¸å¿…è¦çš„ä»£ç 

### 4. unused (1ä¸ª) - ä½ä¼˜å…ˆçº§
æœªä½¿ç”¨çš„å­—æ®µï¼š

```go
// internal/log/logger.go:64
mu   sync.RWMutex  // æœªä½¿ç”¨
```

## ğŸš€ ä½¿ç”¨å»ºè®®

### å¼€å‘æµç¨‹
1. **å¼€å‘å‰**: `make lint-fast` - å¿«é€Ÿæ£€æŸ¥
2. **å¼€å‘ä¸­**: `make lint-fix` - è‡ªåŠ¨ä¿®å¤
3. **æäº¤å‰**: `make lint-strict` - ä¸¥æ ¼æ£€æŸ¥
4. **å®šæœŸ**: `make lint-report` - ç”ŸæˆæŠ¥å‘Š

### CI/CD é›†æˆ
```yaml
- name: Run golangci-lint
  run: make lint-strict
```

### ä¼˜å…ˆçº§ä¿®å¤é¡ºåº
1. **errcheck** - ä¿®å¤é”™è¯¯å¤„ç†
2. **govet** - ä¿®å¤æ ¼å¼å­—ç¬¦ä¸²é—®é¢˜
3. **staticcheck** - ä¿®å¤ä»£ç è´¨é‡é—®é¢˜
4. **unused** - æ¸…ç†æœªä½¿ç”¨çš„ä»£ç 

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [lint.md](./lint.md) - è¯¦ç»†ä½¿ç”¨æŒ‡å—
- [golangci-lint å®˜æ–¹æ–‡æ¡£](https://golangci-lint.run/)
- [Go ä»£ç å®¡æŸ¥æŒ‡å—](https://github.com/golang/go/wiki/CodeReviewComments)

## ğŸ¯ ä¸‹ä¸€æ­¥

1. ä¿®å¤ errcheck é—®é¢˜ï¼ˆé”™è¯¯å¤„ç†ï¼‰
2. ä¿®å¤ govet é—®é¢˜ï¼ˆæ ¼å¼å­—ç¬¦ä¸²ï¼‰
3. é€æ­¥ä¿®å¤ staticcheck é—®é¢˜
4. æ¸…ç†æœªä½¿ç”¨çš„ä»£ç 
5. è€ƒè™‘æ·»åŠ  pre-commit hook è‡ªåŠ¨è¿è¡Œ lint
